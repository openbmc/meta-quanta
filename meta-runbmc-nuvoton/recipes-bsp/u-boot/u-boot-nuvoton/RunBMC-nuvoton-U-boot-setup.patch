From f7676fc14145aad70d289049d5b4bb61b28c1313 Mon Sep 17 00:00:00 2001
From: Samuel Jiang <Samuel.Jiang@quantatw.com>
Date: Thu, 27 Dec 2018 11:18:12 +0800
Subject: [PATCH] RunBMC nuvoton module patch

1. Update SPMOD 0 -> 7
2. Enable VGA setting

%% original patch: RunBMC-nuvoton-U-boot-setup.patch
---
 board/nuvoton/PolegSVB/PolegSVB_init.c | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/board/nuvoton/PolegSVB/PolegSVB_init.c b/board/nuvoton/PolegSVB/PolegSVB_init.c
index 797697b355..ab62ad26d6 100644
--- a/board/nuvoton/PolegSVB/PolegSVB_init.c
+++ b/board/nuvoton/PolegSVB/PolegSVB_init.c
@@ -56,6 +56,9 @@ int print_cpuinfo (void)
 
 	#define ROMCODE_VER     *((PTR32)(ROMCODE_VER_ADDR))
 	#define BOOTER_VER      *((PTR32)(BOOTER_VER_ADDR))
+  #define SPSWC           0x004
+  #define MFSEL1          0x00c
+  #define INTCR           0x03c
 
 	printf(KMAG "RomCode   : v%02x.%02x.%02x.%02x\n", MSB0(ROMCODE_VER), MSB1(ROMCODE_VER), MSB2(ROMCODE_VER), MSB3(ROMCODE_VER));
 	printf("BootBlock : v%02x.%02x.%02x.%02x\n", MSB0(BOOTER_VER),  MSB1(BOOTER_VER),  MSB2(BOOTER_VER),  MSB3(BOOTER_VER));
@@ -64,6 +67,19 @@ int print_cpuinfo (void)
 
 	printf("PolegSVB Power-On Straps = 0x%x\n",(unsigned int)*((PTR32)(GCR_BASE_ADDR + 0x004)));
 
+  unsigned int spmod, hsl1sel, clkref;
+  spmod = 0x06;
+  hsl1sel = 0x400;
+  clkref = 0x20000;
+
+  *((volatile uint32_t *)(GCR_BASE_ADDR + SPSWC)) |= spmod;
+  *((volatile uint32_t *)(GCR_BASE_ADDR + MFSEL1)) |= hsl1sel;
+  *((volatile uint32_t *)(GCR_BASE_ADDR + INTCR)) |= 0x4700;
+  *((volatile uint32_t *)(CLK_BASE_ADDR + 0x004)) &= (~clkref);
+
+
+
+
 	if (STRP_SecureBoot_On())
 	{
         printf("Security: ENABLED, running in secure mode\n");
-- 
2.17.1

